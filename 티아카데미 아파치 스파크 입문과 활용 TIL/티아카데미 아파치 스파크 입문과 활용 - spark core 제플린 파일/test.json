{"paragraphs":[{"text":"//sparksession driver process,어플리케이션 기준 \r\nspark","user":"anonymous","dateUpdated":"2020-12-05T13:32:51+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res1: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@4c3f249d\n"}]},"apps":[],"jobName":"paragraph_1607172220652_-1896802919","id":"20201205-124340_358090010","dateCreated":"2020-12-05T12:43:40+0000","dateStarted":"2020-12-05T13:32:51+0000","dateFinished":"2020-12-05T13:33:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1954"},{"text":"//한개의 컬럼과 1000개의 row(0~999)를 생성한 데이터 프레임을 만든다\r\nval myRange = spark.range(1000).toDF(\"number\")","user":"anonymous","dateUpdated":"2020-12-05T13:33:08+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"myRange: org.apache.spark.sql.DataFrame = [number: bigint]\n"}]},"apps":[],"jobName":"paragraph_1607175171646_1147524817","id":"20201205-133251_323039397","dateCreated":"2020-12-05T13:32:51+0000","dateStarted":"2020-12-05T13:33:08+0000","dateFinished":"2020-12-05T13:33:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1955"},{"text":"%sh\r\n//데이터 다운로드\r\nwget https://raw.githubusercontent.com/databricks/Spark-The-Definitive-Guide/master/data/flight-data/csv/2015-summary.csv","user":"anonymous","dateUpdated":"2020-12-05T13:33:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bash: //데이터: No such file or directory\n--2020-12-05 13:33:39--  https://raw.githubusercontent.com/databricks/Spark-The-Definitive-Guide/master/data/flight-data/csv/2015-summary.csv\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.88.133\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.88.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 7080 (6.9K) [text/plain]\nSaving to: ‘2015-summary.csv’\n\n     0K ......                                                100% 64.4M=0s\n\n2020-12-05 13:33:39 (64.4 MB/s) - ‘2015-summary.csv’ saved [7080/7080]\n\n"}]},"apps":[],"jobName":"paragraph_1607175194313_-131427327","id":"20201205-133314_1996468130","dateCreated":"2020-12-05T13:33:14+0000","dateStarted":"2020-12-05T13:33:38+0000","dateFinished":"2020-12-05T13:33:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1956"},{"text":"%sh\n//데이터 확인\nhead /zeppelin/2015-summary.csv","user":"anonymous","dateUpdated":"2020-12-05T13:34:01+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bash: //데이터: No such file or directory\nDEST_COUNTRY_NAME,ORIGIN_COUNTRY_NAME,count\nUnited States,Romania,15\nUnited States,Croatia,1\nUnited States,Ireland,344\nEgypt,United States,15\nUnited States,India,62\nUnited States,Singapore,1\nUnited States,Grenada,62\nCosta Rica,United States,588\nSenegal,United States,40\n"}]},"apps":[],"jobName":"paragraph_1607175218070_996951647","id":"20201205-133338_332211922","dateCreated":"2020-12-05T13:33:38+0000","dateStarted":"2020-12-05T13:34:01+0000","dateFinished":"2020-12-05T13:34:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1957"},{"text":"%spark\r\n//CSV데이터 데이터 프레임으로 바로 읽기, visit to http://localhost:4040\r\nval flightData2015 = spark.read.option(\"inferSchema\", \"true\").option(\"header\", \"true\").csv(\"/zeppelin/2015-summary.csv\")","user":"anonymous","dateUpdated":"2020-12-05T13:34:17+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"flightData2015: org.apache.spark.sql.DataFrame = [DEST_COUNTRY_NAME: string, ORIGIN_COUNTRY_NAME: string ... 1 more field]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=0","http://172.17.0.2:4040/jobs/job?id=1"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1607175241392_315093490","id":"20201205-133401_478165628","dateCreated":"2020-12-05T13:34:01+0000","dateStarted":"2020-12-05T13:34:17+0000","dateFinished":"2020-12-05T13:34:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1958"},{"text":"//3건만 가져오기\r\nflightData2015.take(3)","user":"anonymous","dateUpdated":"2020-12-05T13:35:55+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res3: Array[org.apache.spark.sql.Row] = Array([United States,Romania,15], [United States,Croatia,1], [United States,Ireland,344])\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=2"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1607175257343_-1438252252","id":"20201205-133417_203693762","dateCreated":"2020-12-05T13:34:17+0000","dateStarted":"2020-12-05T13:35:55+0000","dateFinished":"2020-12-05T13:35:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1959"},{"text":"%spark\r\n//실행계획 확인하기\r\nflightData2015.sort(\"count\").explain()","user":"anonymous","dateUpdated":"2020-12-05T13:36:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Physical Plan ==\n*Sort [count#20 ASC NULLS FIRST], true, 0\n+- Exchange rangepartitioning(count#20 ASC NULLS FIRST, 200)\n   +- *FileScan csv [DEST_COUNTRY_NAME#18,ORIGIN_COUNTRY_NAME#19,count#20] Batched: false, Format: CSV, Location: InMemoryFileIndex[file:/zeppelin/2015-summary.csv], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<DEST_COUNTRY_NAME:string,ORIGIN_COUNTRY_NAME:string,count:int>\n"}]},"apps":[],"jobName":"paragraph_1607175355120_224460720","id":"20201205-133555_1401978874","dateCreated":"2020-12-05T13:35:55+0000","dateStarted":"2020-12-05T13:36:49+0000","dateFinished":"2020-12-05T13:36:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1960"},{"text":"%spark\r\n//count필드로 정렬해서 2개 가져오기\r\nflightData2015.sort(\"count\").take(2)","user":"anonymous","dateUpdated":"2020-12-05T13:36:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res5: Array[org.apache.spark.sql.Row] = Array([United States,Singapore,1], [Moldova,United States,1])\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=3"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1607175409046_-1641940174","id":"20201205-133649_1640776789","dateCreated":"2020-12-05T13:36:49+0000","dateStarted":"2020-12-05T13:36:59+0000","dateFinished":"2020-12-05T13:37:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1961"},{"text":"%spark\n//SQL을 사용하기 위해 임시 view만들기\nflightData2015.createOrReplaceTempView(\"flight_data_2015\")\n","user":"anonymous","dateUpdated":"2020-12-05T13:37:36+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1607175419604_1204117627","id":"20201205-133659_57824422","dateCreated":"2020-12-05T13:36:59+0000","dateStarted":"2020-12-05T13:37:36+0000","dateFinished":"2020-12-05T13:37:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1962"},{"text":"%spark\r\n//SQL로DEST_COUNTRY_NAME 기준으로 몇건인지 확인하는 spark sql실행하기\r\nval sqlWay = spark.sql(\"\"\"\r\nSELECT DEST_COUNTRY_NAME, count(1)\r\nFROM flight_data_2015\r\nGROUP BY DEST_COUNTRY_NAME\r\n\"\"\")","user":"anonymous","dateUpdated":"2020-12-05T13:37:53+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sqlWay: org.apache.spark.sql.DataFrame = [DEST_COUNTRY_NAME: string, count(1): bigint]\n"}]},"apps":[],"jobName":"paragraph_1607175456073_-1293907765","id":"20201205-133736_980872334","dateCreated":"2020-12-05T13:37:36+0000","dateStarted":"2020-12-05T13:37:53+0000","dateFinished":"2020-12-05T13:37:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1963"},{"text":"%spark\r\n//데이터 프레임 통계 보기\r\nsqlWay.describe().show()","user":"anonymous","dateUpdated":"2020-12-05T13:38:07+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+------------------+\n|summary|DEST_COUNTRY_NAME|          count(1)|\n+-------+-----------------+------------------+\n|  count|              132|               132|\n|   mean|             null|1.9393939393939394|\n| stddev|             null|10.792814669253264|\n|    min|          Algeria|                 1|\n|    max|           Zambia|               125|\n+-------+-----------------+------------------+\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=4"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1607175473146_896239599","id":"20201205-133753_2137828812","dateCreated":"2020-12-05T13:37:53+0000","dateStarted":"2020-12-05T13:38:07+0000","dateFinished":"2020-12-05T13:38:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1964"},{"text":"%spark\r\n//데이터 프레임으로 실행계획 확인하기\r\nval dataFrameWay = flightData2015\r\n  .groupBy('DEST_COUNTRY_NAME)\r\n  .count.explain","user":"anonymous","dateUpdated":"2020-12-05T13:38:25+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Physical Plan ==\n*HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[count(1)])\n+- Exchange hashpartitioning(DEST_COUNTRY_NAME#18, 200)\n   +- *HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[partial_count(1)])\n      +- *FileScan csv [DEST_COUNTRY_NAME#18] Batched: false, Format: CSV, Location: InMemoryFileIndex[file:/zeppelin/2015-summary.csv], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<DEST_COUNTRY_NAME:string>\ndataFrameWay: Unit = ()\n"}]},"apps":[],"jobName":"paragraph_1607175487208_1584210408","id":"20201205-133807_217571956","dateCreated":"2020-12-05T13:38:07+0000","dateStarted":"2020-12-05T13:38:25+0000","dateFinished":"2020-12-05T13:38:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1965"},{"text":"%spark\r\n//sql과 dataframe실행계획 비교하기           \r\nsqlWay.explain","user":"anonymous","dateUpdated":"2020-12-05T13:38:39+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Physical Plan ==\n*HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[count(1)])\n+- Exchange hashpartitioning(DEST_COUNTRY_NAME#18, 200)\n   +- *HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[partial_count(1)])\n      +- *FileScan csv [DEST_COUNTRY_NAME#18] Batched: false, Format: CSV, Location: InMemoryFileIndex[file:/zeppelin/2015-summary.csv], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<DEST_COUNTRY_NAME:string>\n"}]},"apps":[],"jobName":"paragraph_1607175505480_-186356785","id":"20201205-133825_1673725138","dateCreated":"2020-12-05T13:38:25+0000","dateStarted":"2020-12-05T13:38:39+0000","dateFinished":"2020-12-05T13:38:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1966"},{"text":"%spark\r\n//sql질의로 max값 가져와서 take로 한건만 확인하기           \r\nspark.sql(\"SELECT max(count) from flight_data_2015\").take(1)","user":"anonymous","dateUpdated":"2020-12-05T13:38:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res9: Array[org.apache.spark.sql.Row] = Array([370002])\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=5"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1607175519424_1806391175","id":"20201205-133839_1344129048","dateCreated":"2020-12-05T13:38:39+0000","dateStarted":"2020-12-05T13:38:56+0000","dateFinished":"2020-12-05T13:38:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1967"},{"text":"%spark\n//데이터 프레임에서 max함수 이용하여 count의 최대값 가져오기           \nimport org.apache.spark.sql.functions.max\n\nflightData2015.select(max(\"count\")).take(1)","user":"anonymous","dateUpdated":"2020-12-05T13:39:22+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.functions.max\nres11: Array[org.apache.spark.sql.Row] = Array([370002])\n"}]},"apps":[],"jobName":"paragraph_1607175536115_675117235","id":"20201205-133856_612295056","dateCreated":"2020-12-05T13:38:56+0000","dateStarted":"2020-12-05T13:39:22+0000","dateFinished":"2020-12-05T13:39:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1968","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=6"],"interpreterSettingId":"spark"}}},{"text":"%spark\r\n//spark sql로 DEST_COUNTRY_NAME 을 집계연산을 수행하여 합계를 구하여 큰 순서대로 5건 확인하기           \r\nval maxSql = spark.sql(\"\"\"\r\nSELECT DEST_COUNTRY_NAME, sum(count) as destination_total\r\nFROM flight_data_2015\r\nGROUP BY DEST_COUNTRY_NAME\r\nORDER BY sum(count) DESC\r\nLIMIT 5\r\n\"\"\")","user":"anonymous","dateUpdated":"2020-12-05T13:39:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175554241_-71775001","id":"20201205-133914_1931677837","dateCreated":"2020-12-05T13:39:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1969","dateFinished":"2020-12-05T13:39:43+0000","dateStarted":"2020-12-05T13:39:43+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"maxSql: org.apache.spark.sql.DataFrame = [DEST_COUNTRY_NAME: string, destination_total: bigint]\n"}]}},{"text":"%spark\n//sql결과 확인하기           \nmaxSql.explain\nmaxSql.show()\n","user":"anonymous","dateUpdated":"2020-12-05T13:39:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175583016_-594875672","id":"20201205-133943_1509879330","dateCreated":"2020-12-05T13:39:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3456","dateFinished":"2020-12-05T13:39:58+0000","dateStarted":"2020-12-05T13:39:56+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Physical Plan ==\nTakeOrderedAndProject(limit=5, orderBy=[aggOrder#218L DESC NULLS LAST], output=[DEST_COUNTRY_NAME#18,destination_total#209L])\n+- *HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[sum(cast(count#20 as bigint)), sum(cast(count#20 as bigint))])\n   +- Exchange hashpartitioning(DEST_COUNTRY_NAME#18, 200)\n      +- *HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[partial_sum(cast(count#20 as bigint)), partial_sum(cast(count#20 as bigint))])\n         +- *FileScan csv [DEST_COUNTRY_NAME#18,count#20] Batched: false, Format: CSV, Location: InMemoryFileIndex[file:/zeppelin/2015-summary.csv], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<DEST_COUNTRY_NAME:string,count:int>\n+-----------------+-----------------+\n|DEST_COUNTRY_NAME|destination_total|\n+-----------------+-----------------+\n|    United States|           411352|\n|           Canada|             8399|\n|           Mexico|             7140|\n|   United Kingdom|             2025|\n|            Japan|             1548|\n+-----------------+-----------------+\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=7"],"interpreterSettingId":"spark"}}},{"text":"%spark\n//동일한 쿼리를 dataframe으로 구현해 봅니다.  End-to-End example\nflightData2015\n.groupBy(\"DEST_COUNTRY_NAME\")\n.sum(\"count\")\n.withColumnRenamed(\"sum(count)\", \"destination_total\")\n.sort(desc(\"destination_total\"))\n.limit(5)\n.explain\n","user":"anonymous","dateUpdated":"2020-12-05T13:40:14+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175596445_-1438919267","id":"20201205-133956_2054813167","dateCreated":"2020-12-05T13:39:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3553","dateFinished":"2020-12-05T13:40:14+0000","dateStarted":"2020-12-05T13:40:14+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Physical Plan ==\nTakeOrderedAndProject(limit=5, orderBy=[destination_total#243L DESC NULLS LAST], output=[DEST_COUNTRY_NAME#18,destination_total#243L])\n+- *HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[sum(cast(count#20 as bigint))])\n   +- Exchange hashpartitioning(DEST_COUNTRY_NAME#18, 200)\n      +- *HashAggregate(keys=[DEST_COUNTRY_NAME#18], functions=[partial_sum(cast(count#20 as bigint))])\n         +- *FileScan csv [DEST_COUNTRY_NAME#18,count#20] Batched: false, Format: CSV, Location: InMemoryFileIndex[file:/zeppelin/2015-summary.csv], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<DEST_COUNTRY_NAME:string,count:int>\n"}]}},{"text":"%spark\nflightData2015\n.groupBy(\"DEST_COUNTRY_NAME\")\n.sum(\"count\")\n.withColumnRenamed(\"sum(count)\", \"destination_total\")\n.sort(desc(\"destination_total\"))\n.limit(5)\n.show()\n","user":"anonymous","dateUpdated":"2020-12-05T13:40:51+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175614103_-808735002","id":"20201205-134014_1408394681","dateCreated":"2020-12-05T13:40:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3668","dateFinished":"2020-12-05T13:40:52+0000","dateStarted":"2020-12-05T13:40:51+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------------+-----------------+\n|DEST_COUNTRY_NAME|destination_total|\n+-----------------+-----------------+\n|    United States|           411352|\n|           Canada|             8399|\n|           Mexico|             7140|\n|   United Kingdom|             2025|\n|            Japan|             1548|\n+-----------------+-----------------+\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=8"],"interpreterSettingId":"spark"}}},{"text":"%spark\n//임의의 값을 가지고 데이터 프레임 생성하기\nval data = Seq((\"Banana\",1000,\"USA\"), (\"Carrots\",1500,\"USA\"), (\"Beans\",1600,\"USA\"),\n      (\"Orange\",2000,\"USA\"),(\"Orange\",2000,\"USA\"),(\"Banana\",400,\"China\"),\n      (\"Carrots\",1200,\"China\"),(\"Beans\",1500,\"China\"),(\"Orange\",4000,\"China\"),\n      (\"Banana\",2000,\"Canada\"),(\"Carrots\",2000,\"Canada\"),(\"Beans\",2000,\"Mexico\"))\n\nimport spark.sqlContext.implicits._\nval df = data.toDF(\"Product\",\"Amount\",\"Country\")\ndf.show()","user":"anonymous","dateUpdated":"2020-12-05T13:42:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175651045_-2031815353","id":"20201205-134051_81871185","dateCreated":"2020-12-05T13:40:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3765","dateFinished":"2020-12-05T13:42:28+0000","dateStarted":"2020-12-05T13:42:27+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+-------+\n|Product|Amount|Country|\n+-------+------+-------+\n| Banana|  1000|    USA|\n|Carrots|  1500|    USA|\n|  Beans|  1600|    USA|\n| Orange|  2000|    USA|\n| Orange|  2000|    USA|\n| Banana|   400|  China|\n|Carrots|  1200|  China|\n|  Beans|  1500|  China|\n| Orange|  4000|  China|\n| Banana|  2000| Canada|\n|Carrots|  2000| Canada|\n|  Beans|  2000| Mexico|\n+-------+------+-------+\n\ndata: Seq[(String, Int, String)] = List((Banana,1000,USA), (Carrots,1500,USA), (Beans,1600,USA), (Orange,2000,USA), (Orange,2000,USA), (Banana,400,China), (Carrots,1200,China), (Beans,1500,China), (Orange,4000,China), (Banana,2000,Canada), (Carrots,2000,Canada), (Beans,2000,Mexico))\nimport spark.sqlContext.implicits._\ndf: org.apache.spark.sql.DataFrame = [Product: string, Amount: int ... 1 more field]\n"}]}},{"text":"//각 제품의 각 국가로 수출 된 총 금액을 얻으려면 제품 별 그룹화, 국가 별 피봇 팅 및 금액 합계를 얻어온다\nval pivotDF = df.groupBy(\"Product\").pivot(\"Country\").sum(\"Amount\")\npivotDF.show()","user":"anonymous","dateUpdated":"2020-12-05T13:42:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175664341_-560587031","id":"20201205-134104_182683014","dateCreated":"2020-12-05T13:41:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3880","dateFinished":"2020-12-05T13:42:42+0000","dateStarted":"2020-12-05T13:42:38+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+-----+------+----+\n|Product|Canada|China|Mexico| USA|\n+-------+------+-----+------+----+\n| Orange|  null| 4000|  null|4000|\n|  Beans|  null| 1500|  2000|1600|\n| Banana|  2000|  400|  null|1000|\n|Carrots|  2000| 1200|  null|1500|\n+-------+------+-----+------+----+\n\npivotDF: org.apache.spark.sql.DataFrame = [Product: string, Canada: bigint ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=9","http://172.17.0.2:4040/jobs/job?id=10","http://172.17.0.2:4040/jobs/job?id=11","http://172.17.0.2:4040/jobs/job?id=12","http://172.17.0.2:4040/jobs/job?id=13","http://172.17.0.2:4040/jobs/job?id=14","http://172.17.0.2:4040/jobs/job?id=15","http://172.17.0.2:4040/jobs/job?id=16"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175758613_1997775238","id":"20201205-134238_1360951861","dateCreated":"2020-12-05T13:42:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4025","text":"//spark2.0에서 성능향상을 위해 pivot대상열을 선언함 \nval countries = Seq(\"USA\",\"China\",\"Canada\",\"Mexico\")\nval pivotDF = df.groupBy(\"Product\").pivot(\"Country\", countries).sum(\"Amount\")\npivotDF.show()","dateUpdated":"2020-12-05T13:42:50+0000","dateFinished":"2020-12-05T13:42:52+0000","dateStarted":"2020-12-05T13:42:50+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+----+-----+------+------+\n|Product| USA|China|Canada|Mexico|\n+-------+----+-----+------+------+\n| Orange|4000| 4000|  null|  null|\n|  Beans|1600| 1500|  null|  2000|\n| Banana|1000|  400|  2000|  null|\n|Carrots|1500| 1200|  2000|  null|\n+-------+----+-----+------+------+\n\ncountries: Seq[String] = List(USA, China, Canada, Mexico)\npivotDF: org.apache.spark.sql.DataFrame = [Product: string, USA: bigint ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=17","http://172.17.0.2:4040/jobs/job?id=18","http://172.17.0.2:4040/jobs/job?id=19","http://172.17.0.2:4040/jobs/job?id=20","http://172.17.0.2:4040/jobs/job?id=21"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175770059_1952996599","id":"20201205-134250_477862","dateCreated":"2020-12-05T13:42:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4154","text":"//성능 향상을 위해 두단계 집계를 사용함 \nval pivotDF = df.groupBy(\"Product\",\"Country\")\n      .sum(\"Amount\")\n      .groupBy(\"Product\")\n      .pivot(\"Country\")\n      .sum(\"sum(Amount)\")\npivotDF.show()","dateUpdated":"2020-12-05T13:43:01+0000","dateFinished":"2020-12-05T13:43:06+0000","dateStarted":"2020-12-05T13:43:01+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+-----+------+----+\n|Product|Canada|China|Mexico| USA|\n+-------+------+-----+------+----+\n| Orange|  null| 4000|  null|4000|\n|  Beans|  null| 1500|  2000|1600|\n| Banana|  2000|  400|  null|1000|\n|Carrots|  2000| 1200|  null|1500|\n+-------+------+-----+------+----+\n\npivotDF: org.apache.spark.sql.DataFrame = [Product: string, Canada: bigint ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=22","http://172.17.0.2:4040/jobs/job?id=23","http://172.17.0.2:4040/jobs/job?id=24","http://172.17.0.2:4040/jobs/job?id=25","http://172.17.0.2:4040/jobs/job?id=26","http://172.17.0.2:4040/jobs/job?id=27","http://172.17.0.2:4040/jobs/job?id=28","http://172.17.0.2:4040/jobs/job?id=29"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175781811_1556858131","id":"20201205-134301_232146421","dateCreated":"2020-12-05T13:43:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4277","text":"//stack기능을 이용하여 주요 국가에 대해 unpivot을 수행\nval unPivotDF = pivotDF.select($\"Product\",\nexpr(\"stack(4, 'Canada', Canada, 'China', China, 'Mexico', Mexico, 'USA', USA) as (Country,Total)\"))\n.where(\"Total is not null\")\nunPivotDF.show()","dateUpdated":"2020-12-05T13:43:11+0000","dateFinished":"2020-12-05T13:43:13+0000","dateStarted":"2020-12-05T13:43:11+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+-----+\n|Product|Country|Total|\n+-------+-------+-----+\n| Orange|  China| 4000|\n| Orange|    USA| 4000|\n|  Beans|  China| 1500|\n|  Beans| Mexico| 2000|\n|  Beans|    USA| 1600|\n| Banana| Canada| 2000|\n| Banana|  China|  400|\n| Banana|    USA| 1000|\n|Carrots| Canada| 2000|\n|Carrots|  China| 1200|\n|Carrots|    USA| 1500|\n+-------+-------+-----+\n\nunPivotDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [Product: string, Country: string ... 1 more field]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=30","http://172.17.0.2:4040/jobs/job?id=31","http://172.17.0.2:4040/jobs/job?id=32","http://172.17.0.2:4040/jobs/job?id=33","http://172.17.0.2:4040/jobs/job?id=34"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"DEST_COUNTRY_NAME":"string","destination_total":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1607175791043_100453811","id":"20201205-134311_1522788382","dateCreated":"2020-12-05T13:43:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4406","text":"%sql\r\nSELECT DEST_COUNTRY_NAME, sum(count) as destination_total\r\nFROM flight_data_2015\r\nGROUP BY DEST_COUNTRY_NAME\r\nORDER BY sum(count) DESC\r\nLIMIT 5","dateUpdated":"2020-12-05T14:07:11+0000","dateFinished":"2020-12-05T14:07:11+0000","dateStarted":"2020-12-05T14:07:09+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"DEST_COUNTRY_NAME\tdestination_total\nUnited States\t411352\nCanada\t8399\nMexico\t7140\nUnited Kingdom\t2025\nJapan\t1548\n"},{"type":"TEXT","data":""}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=35"],"interpreterSettingId":"spark"}}}],"name":"test","id":"2FUM14QMH","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}